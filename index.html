<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸€å…ƒä¸€æ¬¡ä¿„ç½—æ–¯</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --text-color: #e94560;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #fff;
            font-family: var(--font-main);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            touch-action: manipulation;
        }

        /* é¡¶éƒ¨æ§åˆ¶æ  */
        #top-bar {
            width: 100%;
            background: #0f3460;
            padding: 5px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            height: 50px;
            box-sizing: border-box;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .volume-slider {
            width: 70px;
            cursor: pointer;
        }

        .title-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
            justify-content: center;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            font-size: 14px;
            color: white;
            user-select: none;
        }

        .btn-fullscreen {
            background: #6c757d;
        }

        .btn-help {
            background: #007bff;
        }

        .btn-start {
            background: #28a745;
            padding: 8px 25px;
            font-size: 16px;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
            white-space: nowrap;
        }

        .btn-restart {
            background: #f39c12;
            padding: 8px 20px;
            display: none;
        }

        .btn-audio {
            background: #533483;
            min-width: 70px;
        }

        /* æ¸¸æˆä¸»å®¹å™¨ */
        #game-container {
            display: flex;
            width: 100%;
            flex: 1;
            justify-content: center;
            align-items: center;
            padding: 5px;
            box-sizing: border-box;
            height: calc(100vh - 50px);
            gap: 5px;
        }

        .player-section {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            width: 50%;
            height: 100%;
            position: relative;
            gap: 15px;
        }

        #player-b {
            flex-direction: row-reverse;
        }

        .board-container {
            display: flex;
            gap: 5px;
            background: var(--panel-color);
            padding: 8px;
            border-radius: 12px;
            border: 2px solid #533483;
            max-height: 85%;
            position: relative;
        }

        canvas {
            background: #000;
            border: 1px solid #333;
            height: auto;
            max-height: 60vh;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 10px;
            width: 60px;
        }

        .info-box {
            background: #0f3460;
            padding: 5px;
            border-radius: 5px;
            text-align: center;
        }

        .info-label {
            font-size: 10px;
            color: #ccc;
        }

        .info-value {
            font-size: 14px;
            font-weight: bold;
            color: #00d4ff;
        }

        /* é›†ä¸­å¼æ§åˆ¶æŒ‰é’®åŒº */
        .touch-controls {
            display: none;
            grid-template-columns: repeat(2, 75px);
            grid-template-rows: 70px 70px 70px;
            gap: 4px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
        }

        .t-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            user-select: none;
            touch-action: none;
        }

        .t-btn:active,
        .t-btn.active {
            background: var(--text-color);
            transform: scale(0.95);
        }

        .t-btn.up {
            grid-column: span 2;
            grid-row: 1;
            font-size: 18px;
            font-weight: bold;
            color: #00ffcc;
        }

        .t-btn.left {
            grid-column: 1;
            grid-row: 2;
            border-right-width: 1px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .t-btn.right {
            grid-column: 2;
            grid-row: 2;
            border-left-width: 1px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        .t-btn.down {
            grid-column: span 2;
            grid-row: 3;
        }

        /* æ–¹ç¨‹å¼è§£é¢˜åŒº - å®Œå…¨åœ¨ç›˜é¢å¤–ä¾§æ˜¾ç¤º */
        .math-overlay {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 200px;
            background: rgba(10, 30, 60, 0.98);
            border: 4px solid var(--text-color);
            border-radius: 15px;
            padding: 15px 8px;
            text-align: center;
            display: none;
            z-index: 500;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
        }

        #math-a {
            right: 100%;
            left: auto;
            margin-right: 10px;
        }

        #math-b {
            left: 100%;
            right: auto;
            margin-left: 10px;
        }

        @media (max-width: 700px) {
            .math-overlay {
                width: 150px;
                padding: 10px 5px;
            }
            .math-equation {
                font-size: 18px;
                padding: 8px 5px;
                margin-bottom: 10px;
            }
            .math-options {
                gap: 6px;
            }
            .option-btn {
                padding: 10px 4px;
                font-size: 16px;
            }
        }

        @media (max-width: 500px) {
            .math-overlay {
                width: 120px;
                padding: 8px 4px;
            }
            .math-equation {
                font-size: 14px;
                padding: 6px 4px;
                margin-bottom: 8px;
            }
            .option-btn {
                padding: 8px 3px;
                font-size: 14px;
            }
        }

        .math-equation {
            font-size: 26px;
            margin-bottom: 20px;
            color: #00ffcc;
            background: #000;
            padding: 15px 10px;
            border-radius: 8px;
            word-break: keep-all;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: bold;
            border: 1px solid #333;
        }

        .math-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            padding: 15px 5px;
            background: #533483;
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 12px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn.selected {
            background: #e94560;
            border-color: #00ffcc;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }

        .answer-feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            font-weight: bold;
            z-index: 600;
            pointer-events: none;
            animation: feedbackPop 0.5s ease-out;
        }

        .answer-feedback.correct {
            color: #00ffcc;
        }

        .answer-feedback.wrong {
            color: #ff4444;
        }

        @keyframes feedbackPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* è¯´æ˜çª—å£ä¼˜åŒ– */
        #help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .help-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid #e94560;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
        }

        .help-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
            color: #eee;
        }

        .help-table th,
        .help-table td {
            border: 1px solid #333;
            padding: 12px;
            text-align: left;
        }

        .help-table th {
            background: #0f3460;
            color: #00ffcc;
            font-weight: bold;
        }

        .help-table ul {
            margin: 0;
            padding-left: 20px;
        }

        .help-table li {
            margin-bottom: 5px;
        }

        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.4);
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.05s;
        }


        .review-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            z-index: 2200;
            overflow-y: auto;
            padding: 10px;
            box-sizing: border-box;
        }

        .review-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            color: #fff;
        }

        .review-title {
            text-align: center;
            color: #ffcc00;
            font-size: 24px;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .review-columns {
            display: flex;
            flex: 1;
            gap: 15px;
            overflow: hidden;
        }

        .review-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 2px solid #333;
            border-radius: 10px;
            overflow: hidden;
        }

        .review-column-header {
            background: #0f3460;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #00ffcc;
        }

        .review-column-questions {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .review-column-footer {
            padding: 10px;
            text-align: center;
            border-top: 1px solid #333;
            background: rgba(15, 52, 96, 0.5);
        }

        .review-status {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .review-status.pass {
            color: #00ff00;
        }

        .review-status.fail {
            color: #ff4444;
        }

        .review-global-footer {
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
        }

        .review-question {
            background: rgba(30, 60, 114, 0.8);
            border: 2px solid #0f3460;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .review-question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #888;
        }

        .review-equation {
            font-size: 20px;
            color: #00ffcc;
            margin-bottom: 15px;
            text-align: center;
        }

        .review-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .review-option {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .review-option.normal {
            background: #1e3c72;
            border: 2px solid #2d5aa8;
        }

        .review-option.wrong-original {
            background: #8b0000;
            border: 2px solid #ff4444;
        }

        .review-option.selected {
            background: #2d5aa8;
            border: 2px solid #00ffcc;
        }

        .review-option.correct-revealed {
            background: #006400;
            border: 2px solid #00ff00;
        }

        .review-option.wrong-revealed {
            background: #8b0000;
            border: 2px solid #ff4444;
        }

        .review-option:hover:not(.correct-revealed):not(.wrong-revealed) {
            transform: scale(1.02);
        }

        .review-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .review-btn {
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .review-btn:hover {
            transform: scale(1.05);
        }

        .review-btn.submit {
            background: linear-gradient(135deg, #00c853, #00e676);
            color: #000;
        }

        .review-btn.retry {
            background: linear-gradient(135deg, #ff6f00, #ffab00);
            color: #000;
        }

        .review-btn.restart {
            background: linear-gradient(135deg, #e91e63, #f06292);
            color: #fff;
        }

        .no-wrong-answers {
            text-align: center;
            font-size: 24px;
            color: #00ff00;
            padding: 40px;
        }

        .practice-questions {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .practice-question {
            background: rgba(30, 60, 114, 0.8);
            border: 2px solid #0f3460;
            border-radius: 10px;
            padding: 20px;
        }

        .practice-question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #888;
        }

        .practice-result-mark {
            font-size: 28px;
            font-weight: bold;
        }

        .practice-result-mark.correct {
            color: #00ffcc;
        }

        .practice-result-mark.wrong {
            color: #ff4444;
        }

        .practice-equation {
            font-size: 24px;
            color: #00ffcc;
            margin-bottom: 15px;
            text-align: center;
            background: #000;
            padding: 10px;
            border-radius: 8px;
        }

        .practice-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .practice-option {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            background: #1e3c72;
            border: 2px solid #2d5aa8;
            color: white;
        }

        .practice-option:hover {
            transform: scale(1.02);
        }

        .practice-option.selected {
            background: #2d5aa8;
            border: 2px solid #00ffcc;
        }

        .practice-option.correct-revealed {
            background: #006400;
            border: 2px solid #00ff00;
        }

        .practice-option.wrong-revealed {
            background: #8b0000;
            border: 2px solid #ff4444;
        }

        .practice-solution {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffcc00;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .practice-solution-title {
            color: #ffcc00;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .practice-solution-step {
            color: #ccc;
            margin: 8px 0;
            padding-left: 10px;
            border-left: 2px solid #ffcc00;
        }

        .practice-solution-answer {
            color: #00ff00;
            font-weight: bold;
            margin-top: 10px;
        }

        .board-result-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            padding: 20px 10px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 100;
        }

        .board-result-overlay.winner {
            border: 3px solid #00ff00;
            animation: winnerPulse 0.8s ease-in-out infinite alternate;
        }

        @keyframes winnerPulse {
            from {
                box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
            }
            to {
                box-shadow: 0 0 20px #00ff00, 0 0 40px #00ff00, 0 0 60px #00ff00;
            }
        }

        .celebration-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 99;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-20px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(400px) rotate(720deg);
            }
        }

        .board-result-overlay.loser {
            border: 3px solid #ff4444;
        }

        .board-result-text {
            font-size: 24px;
            font-weight: bold;
        }

        .board-result-text.winner {
            color: #00ff00;
        }

        .board-result-text.loser {
            color: #ff4444;
        }

        .global-over-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 20px;
            z-index: 2100;
            flex-wrap: wrap;
            justify-content: center;
        }

        .score-pop {
            position: absolute;
            color: #00ffcc;
            font-weight: bold;
            font-size: 24px;
            animation: fadeUp 1.2s forwards;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes fadeUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }

            to {
                opacity: 0;
                transform: translate(-50%, -60px);
            }
        }
    </style>
</head>

<body>

    <div id="flash-overlay"></div>

    <div id="top-bar">
        <div class="audio-controls">
            <button class="btn btn-fullscreen" onclick="toggleFullScreen()">â›¶ å…¨å±</button>
            <button class="btn btn-audio" id="bgm-toggle" onclick="toggleMusic()">éŸ³ä¹: å¼€</button>
            <button class="btn btn-audio" id="sfx-toggle" onclick="toggleSFX()">éŸ³æ•ˆ: å¼€</button>
            <div class="volume-control">
                <span>ğŸ”Š</span>
                <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.1" value="0.5"
                    oninput="updateVolume(this.value)">
            </div>
        </div>

        <div class="title-group">
            <!-- æ ‡é¢˜ä¿®æ”¹ä¸ºæŒ‡å®šåç§° -->
            <div style="font-weight: bold; font-size: 18px;">ğŸ•¹ï¸ ä¸€å…ƒä¸€æ¬¡ä¿„ç½—æ–¯</div>
        </div>

        <div>
            <button class="btn btn-start" id="main-start-btn" onclick="startGameSession()">å¼€å§‹æˆ˜æ–—</button>
            <button class="btn btn-start" id="practice-btn" onclick="openPracticeMode()" style="background: #17a2b8; box-shadow: 0 0 15px rgba(23, 162, 184, 0.6);">ç»ƒä¹ </button>
            <button class="btn btn-restart" id="restart-btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <div id="game-container">
        <!-- ç©å®¶ A (å·¦) -->
        <div id="player-a" class="player-section">
            <div class="touch-controls" id="touch-a">
                <div class="t-btn up" onmousedown="touchInput(event, 'A', 'up', true)"
                    onmouseup="touchInput(event, 'A', 'up', false)" ontouchstart="touchInput(event, 'A', 'up', true)"
                    ontouchend="touchInput(event, 'A', 'up', false)">æ—‹è½¬</div>
                <div class="t-btn left" onmousedown="touchInput(event, 'A', 'left', true)"
                    onmouseup="touchInput(event, 'A', 'left', false)"
                    ontouchstart="touchInput(event, 'A', 'left', true)"
                    ontouchend="touchInput(event, 'A', 'left', false)">â†</div>
                <div class="t-btn right" onmousedown="touchInput(event, 'A', 'right', true)"
                    onmouseup="touchInput(event, 'A', 'right', false)"
                    ontouchstart="touchInput(event, 'A', 'right', true)"
                    ontouchend="touchInput(event, 'A', 'right', false)">â†’</div>
                <div class="t-btn down" onmousedown="touchInput(event, 'A', 'down', true)"
                    onmouseup="touchInput(event, 'A', 'down', false)"
                    ontouchstart="touchInput(event, 'A', 'down', true)"
                    ontouchend="touchInput(event, 'A', 'down', false)">â†“</div>
            </div>

            <div class="board-container">
                <canvas id="canvas-a" width="200" height="400"></canvas>
                <div class="side-panel">
                    <div class="info-box">
                        <div class="info-label">NEXT</div>
                        <canvas id="next-a" width="50" height="50"></canvas>
                    </div>
                    <div class="info-box">
                        <div class="info-label">SCORE</div>
                        <div id="score-a" class="info-value">0</div>
                    </div>
                </div>
                <div id="math-a" class="math-overlay">
                    <div class="math-equation" id="eq-a">x + 5 = 12</div>
                    <div class="math-options" id="options-a"></div>
                </div>
                <div id="result-a" class="board-result-overlay">
                    <div id="result-text-a" class="board-result-text"></div>
                </div>
            </div>
        </div>

        <!-- ç©å®¶ B (å³) -->
        <div id="player-b" class="player-section">
            <div class="touch-controls" id="touch-b">
                <div class="t-btn up" onmousedown="touchInput(event, 'B', 'up', true)"
                    onmouseup="touchInput(event, 'B', 'up', false)" ontouchstart="touchInput(event, 'B', 'up', true)"
                    ontouchend="touchInput(event, 'B', 'up', false)">æ—‹è½¬</div>
                <div class="t-btn left" onmousedown="touchInput(event, 'B', 'left', true)"
                    onmouseup="touchInput(event, 'B', 'left', false)"
                    ontouchstart="touchInput(event, 'B', 'left', true)"
                    ontouchend="touchInput(event, 'B', 'left', false)">â†</div>
                <div class="t-btn right" onmousedown="touchInput(event, 'B', 'right', true)"
                    onmouseup="touchInput(event, 'B', 'right', false)"
                    ontouchstart="touchInput(event, 'B', 'right', true)"
                    ontouchend="touchInput(event, 'B', 'right', false)">â†’</div>
                <div class="t-btn down" onmousedown="touchInput(event, 'B', 'down', true)"
                    onmouseup="touchInput(event, 'B', 'down', false)"
                    ontouchstart="touchInput(event, 'B', 'down', true)"
                    ontouchend="touchInput(event, 'B', 'down', false)">â†“</div>
            </div>

            <div class="board-container">
                <canvas id="canvas-b" width="200" height="400"></canvas>
                <div class="side-panel">
                    <div class="info-box">
                        <div class="info-label">NEXT</div>
                        <canvas id="next-b" width="50" height="50"></canvas>
                    </div>
                    <div class="info-box">
                        <div class="info-label">SCORE</div>
                        <div id="score-b" class="info-value">0</div>
                    </div>
                </div>
                <div id="math-b" class="math-overlay">
                    <div class="math-equation" id="eq-b">2x - 4 = 10</div>
                    <div class="math-options" id="options-b"></div>
                </div>
                <div id="result-b" class="board-result-overlay">
                    <div id="result-text-b" class="board-result-text"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»“ç®—ç”»é¢æŒ‰é’® (æ˜¾ç¤ºåœ¨ä¸­ä¸‹æ–¹) -->
    <div id="global-over-buttons" class="global-over-buttons">
        <button class="btn btn-help"
            style="padding: 15px 30px; font-size: 18px; color: white;"
            onclick="openReview()" ontouchstart="openReview()">ç­”é¢˜å¤ç›˜</button>
        <button class="btn btn-help"
            style="padding: 15px 30px; font-size: 18px; color: white;"
            onclick="location.reload()" ontouchstart="location.reload()">é‡æ–°å¯¹å†³</button>
    </div>

    <!-- ç»ƒä¹ æ¨¡å¼ç•Œé¢ -->
    <div id="practice-overlay" class="review-overlay">
        <div class="review-content">
            <h2 class="review-title">ç»ƒä¹ æ¨¡å¼</h2>
            <div class="practice-questions" id="practice-questions"></div>
            <div class="review-global-footer">
                <button class="review-btn submit" id="practice-submit" onclick="submitPractice()">æäº¤ç­”æ¡ˆ</button>
                <button class="review-btn retry" id="practice-retry" onclick="openPracticeMode()" style="display:none;">å†æ¬¡ç»ƒä¹ </button>
                <button class="review-btn restart" id="practice-home" onclick="closePracticeMode()" style="display:none;">è¿”å›ä¸»é¡µ</button>
            </div>
        </div>
    </div>

    <!-- ç­”é¢˜å¤ç›˜ç•Œé¢ -->
    <div id="review-overlay" class="review-overlay">
        <div class="review-content">
            <h2 class="review-title">ç­”é¢˜å¤ç›˜</h2>
            <div class="review-columns">
                <div class="review-column" id="review-col-a">
                    <div class="review-column-header">ç©å®¶ A ç­”é”™çš„é¢˜</div>
                    <div class="review-column-questions" id="review-questions-a"></div>
                    <div class="review-column-footer">
                        <div class="review-status" id="review-status-a"></div>
                        <button class="review-btn submit" id="submit-a" onclick="submitReviewPlayer('A')">æäº¤ç­”æ¡ˆ</button>
                    </div>
                </div>
                <div class="review-column" id="review-col-b">
                    <div class="review-column-header">ç©å®¶ B ç­”é”™çš„é¢˜</div>
                    <div class="review-column-questions" id="review-questions-b"></div>
                    <div class="review-column-footer">
                        <div class="review-status" id="review-status-b"></div>
                        <button class="review-btn submit" id="submit-b" onclick="submitReviewPlayer('B')">æäº¤ç­”æ¡ˆ</button>
                    </div>
                </div>
            </div>
            <div class="review-global-footer">
                <button class="review-btn restart" id="review-restart" onclick="location.reload()" style="display:none;">é‡æ–°å¯¹å†³</button>
            </div>
        </div>
    </div>

    <div id="help-overlay">
        <div class="help-content">
            <!-- æ ‡é¢˜ä¿®æ”¹ä¸ºæŒ‡å®šåç§° -->
            <h2 style="text-align: center; color: var(--text-color);">ä¸€å…ƒä¸€æ¬¡ä¿„ç½—æ–¯</h2>

            <table class="help-table">
                <thead>
                    <tr>
                        <th>åŠŸèƒ½</th>
                        <th>é”®ç›˜ç©å®¶ A/B</th>
                        <th>PS/2 æ‘‡æ†</th>
                        <th>å¹³æ¿è§¦æ§</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å·¦å³ç§»åŠ¨</td>
                        <td>A,D / â†,â†’</td>
                        <td>åå­—é”® å·¦å³</td>
                        <td>ä¸­é—´å¹¶æ’æŒ‰é’®</td>
                    </tr>
                    <tr>
                        <td>åŠ é€Ÿä¸‹è½</td>
                        <td>S / â†“</td>
                        <td>å·¦æ‘‡æ† ä¸‹</td>
                        <td>æœ€ä¸‹æ–¹æŒ‰é’®</td>
                    </tr>
                    <tr>
                        <td>æ—‹è½¬æ–¹å—</td>
                        <td>W / â†‘</td>
                        <td>æŒ‰é’® 2 (B)</td>
                        <td>æœ€ä¸Šæ–¹æŒ‰é’®</td>
                    </tr>
                    <tr>
                        <td>ç­”é¢˜é€‰æ‹©</td>
                        <td>WASD / æ–¹å‘é”®</td>
                        <td>åå­—é”®</td>
                        <td><strong>ç›´æ¥ç‚¹é€‰é€‰é¡¹</strong></td>
                    </tr>
                    <tr>
                        <td>ç­”é¢˜ç¡®è®¤</td>
                        <td>Q / Enter</td>
                        <td>æŒ‰é’® 1 (A)</td>
                        <td>æ— éœ€æŒ‰é’®</td>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align:center; background:#16213e; color:#00ffcc;">æ¸¸æˆè§„åˆ™ä¸é‡ç‚¹</th>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <ul>
                                <li>æ¶ˆé™¤è¡Œæ•°å³å¯å‘åŠ¨æ”»å‡»ï¼Œå¯¹æ‰‹éœ€ç­”å¯¹æ–¹ç¨‹å¼æ–¹å¯æ¢å¤æ“ä½œã€‚</li>
                                <li>åŒ…å« "B" å­—çš„å°æ ¼è¢«æ¶ˆé™¤åä¼šäº§ç”Ÿç‚¸å¼¹ï¼Œè½åœ°ç«‹å³å¼•çˆ† 5x5 èŒƒå›´ã€‚</li>
                                <li><strong>è´¥æˆ˜åˆ¤å®šï¼š</strong> 1. æ–°æ–¹å—äº§ç”Ÿæ—¶ä½ç½®è¢«å æ®ã€‚ 2. è¢«åƒåœ¾è¡Œæ¨æŒ¤å¯¼è‡´æ–¹å—æº¢å‡ºé¡¶éƒ¨ã€‚</li>
                                <li>æ‰€æœ‰é¢˜ç›®ä¹‹ç³»æ•°ã€å¸¸æ•°ä¸ç­”æ¡ˆå‡ä¿è¯ä¸ä¸º 0ã€‚</li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p style="text-align: center; color: #ffcc00; font-weight: bold;">è¯·ç‚¹å‡»å³ä¸Šè§’ã€Œå¼€å§‹æˆ˜æ–—ã€å¯åŠ¨æ¸¸æˆ</p>
            <p style="text-align: center; color: #888; font-size: 12px; margin-top: 15px;">Credits: Forked from [ä¸€å…ƒä¸€æ¬¡ä¿„ç¾…æ–¯(æ±èˆˆã„šæ°è£½)] by [æ±èˆˆã„šæ°].</p>
        </div>
    </div>

    <script>
        const COLS = 10, ROWS = 20, BLOCK_SIZE = 20;
        const COLORS = [null, '#FF0D72', '#0DC2FF', '#0DFF72', '#F538FF', '#FF8E0D', '#FFE138', '#3877FF', '#777', null, '#FFD700', '#FF4500'];
        const SHAPES = [[], [[0, 1, 0], [1, 1, 1], [0, 0, 0]], [[0, 2, 0, 0], [0, 2, 0, 0], [0, 2, 0, 0], [0, 2, 0, 0]], [[0, 3, 3], [3, 3, 0], [0, 0, 0]], [[4, 4, 0], [0, 4, 4], [0, 0, 0]], [[5, 0, 0], [5, 5, 5], [0, 0, 0]], [[0, 0, 6], [6, 6, 6], [0, 0, 0]], [[7, 7], [7, 7]]];

        let isPaused = true, isGameOver = false;
        const BGM_FILES = ['bgmusic(1).mp3', 'bgmusic(2).mp3', 'bgmusic(3).mp3', 'bgmusic(4).mp3', 'bgmusic(5).mp3', 'bgmusic(6).mp3', 'bgmusic(7).mp3'];
        const SFX_FILE = 'stonefall.mp3';
        let currentBgmIndex = 0, audioEnabled = true, sfxEnabled = true, currentVolume = 0.5;
        let bgmPlayer = new Audio(), sfxPlayer = new Audio();

        function updateVolume(val) {currentVolume = parseFloat(val); bgmPlayer.volume = currentVolume; sfxPlayer.volume = currentVolume;}
        function toggleFullScreen() {if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else if (document.exitFullscreen) document.exitFullscreen();}
        function playStonefall() {if (sfxEnabled) {sfxPlayer.src = SFX_FILE; sfxPlayer.volume = currentVolume; sfxPlayer.play().catch(() => { });} }
        async function flashScreen() {
            const overlay = document.getElementById('flash-overlay'); playStonefall();
            for (let i = 0; i < 3; i++) {overlay.style.opacity = '1'; await new Promise(r => setTimeout(r, 80)); overlay.style.opacity = '0'; await new Promise(r => setTimeout(r, 80));}
        }
        function toggleMusic() {audioEnabled = !audioEnabled; document.getElementById('bgm-toggle').innerText = `éŸ³ä¹: ${audioEnabled ? 'å¼€' : 'å…³'}`; if (audioEnabled) playNextBgm(); else bgmPlayer.pause();}
        function toggleSFX() {sfxEnabled = !sfxEnabled; document.getElementById('sfx-toggle').innerText = `éŸ³æ•ˆ: ${sfxEnabled ? 'å¼€' : 'å…³'}`;}
        function playNextBgm() {
            if (!audioEnabled) return; bgmPlayer.src = BGM_FILES[currentBgmIndex]; bgmPlayer.volume = currentVolume;
            bgmPlayer.play().catch(() => {currentBgmIndex = (currentBgmIndex + 1) % BGM_FILES.length; playNextBgm();});
            currentBgmIndex = (currentBgmIndex + 1) % BGM_FILES.length;
        }
        bgmPlayer.onended = playNextBgm;

        class MathEngine {
            static generateByLines(lines) {
                let a, b, c, d, f, x, eq, distractors;
                while (true) {x = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1); if (x !== 0) break;}
                if (lines === 1) {
                    while (true) {a = (Math.floor(Math.random() * 15) + 1) * (Math.random() > 0.5 ? 1 : -1); b = x + a; if (a !== 0 && b !== 0) break;}
                    eq = `x ${a >= 0 ? '+' : '-'} ${Math.abs(a)} = ${b}`;
                    distractors = this.getDistractorsType1(x, a, b);
                } else if (lines === 2) {
                    while (true) {a = (Math.floor(Math.random() * 5) + 2) * (Math.random() > 0.5 ? 1 : -1); b = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1); c = a * x + b; if (a !== 0 && b !== 0 && c !== 0) break;}
                    eq = `${a}x ${b >= 0 ? '+' : '-'} ${Math.abs(b)} = ${c}`;
                    distractors = this.getDistractorsType2(x, a, b, c);
                } else if (lines === 3) {
                    while (true) {a = (Math.floor(Math.random() * 4) + 2) * (Math.random() > 0.5 ? 1 : -1); b = (Math.floor(Math.random() * 6) + 1) * (Math.random() > 0.5 ? 1 : -1); c = a * (x + b); if (a !== 0 && b !== 0 && c !== 0) break;}
                    eq = `${a}(x ${b >= 0 ? '+' : '-'} ${Math.abs(b)}) = ${c}`;
                    distractors = this.getDistractorsType3(x, a, b, c);
                } else {
                    while (true) {a = Math.floor(Math.random() * 3) + 2; b = Math.floor(Math.random() * 3) + 2; c = (Math.floor(Math.random() * 5) + 1) * (Math.random() > 0.5 ? 1 : -1); d = (Math.floor(Math.random() * 5) + 1) * (Math.random() > 0.5 ? 1 : -1); f = (a * b - 1) * x + a * c + d; if (a !== 0 && b !== 0 && c !== 0 && d !== 0 && f !== 0) break;}
                    const cSign = c >= 0 ? '+' : '-'; const dSign = d >= 0 ? '+' : '-'; const fSign = f >= 0 ? '+' : '-';
                    eq = `${a}(${b}x ${cSign} ${Math.abs(c)}) ${dSign} ${Math.abs(d)} = x ${fSign} ${Math.abs(f)}`;
                    distractors = this.getDistractorsType4(x, a, b, c, d, f);
                }
                let options = this.buildOptions(x, distractors);
                return {equation: eq, answer: x, options};
            }

            static getDistractorsType1(x, a, b) {
                const candidates = [
                    b + a,
                    -x,
                    a - b
                ];
                return candidates;
            }

            static getDistractorsType2(x, a, b, c) {
                const candidates = [
                    (c + b) / a,
                    c - b,
                    -x
                ];
                return candidates;
            }

            static getDistractorsType3(x, a, b, c) {
                const candidates = [
                    c / a,
                    c / a + b,
                    -x
                ];
                return candidates;
            }

            static getDistractorsType4(x, a, b, c, d, f) {
                const candidates = [
                    -x,
                    x + 1,
                    x - 1
                ];
                return candidates;
            }

            static buildOptions(correctAnswer, distractors) {
                let options = [correctAnswer];
                let filtered = distractors
                    .filter(d => Number.isFinite(d) && Number.isInteger(d) && d !== correctAnswer)
                    .filter((d, i, arr) => arr.indexOf(d) === i);
                for (let d of filtered) {
                    if (options.length >= 4) break;
                    if (!options.includes(d)) options.push(d);
                }
                let fallback = 1;
                while (options.length < 4) {
                    const candidate = correctAnswer + fallback;
                    if (!options.includes(candidate)) options.push(candidate);
                    fallback = fallback > 0 ? -fallback : -fallback + 1;
                }
                return this.shuffle(options.slice(0, 4));
            }

            static shuffle(arr) {return arr.sort(() => Math.random() - 0.5);}

            static generatePractice(type) {
                let a, b, c, x, eq, solution, distractors;
                while (true) {x = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1); if (x !== 0) break;}

                if (type === 1) {
                    while (true) {a = (Math.floor(Math.random() * 15) + 1) * (Math.random() > 0.5 ? 1 : -1); b = x + a; if (a !== 0 && b !== 0) break;}
                    eq = `x ${a >= 0 ? '+' : '-'} ${Math.abs(a)} = ${b}`;
                    distractors = this.getDistractorsType1(x, a, b);
                    
                    if (a >= 0) {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼šx + ' + a + ' = ' + b + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„å‡å» ' + a + '</div>' +
                            '<div class="practice-solution-step">x + ' + a + ' - ' + a + ' = ' + b + ' - ' + a + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    } else {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼šx - ' + Math.abs(a) + ' = ' + b + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„åŠ ä¸Š ' + Math.abs(a) + '</div>' +
                            '<div class="practice-solution-step">x - ' + Math.abs(a) + ' + ' + Math.abs(a) + ' = ' + b + ' + ' + Math.abs(a) + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    }
                } else if (type === 2) {
                    while (true) {a = (Math.floor(Math.random() * 5) + 2) * (Math.random() > 0.5 ? 1 : -1); b = (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1); c = a * x + b; if (a !== 0 && b !== 0 && c !== 0) break;}
                    eq = `${a}x ${b >= 0 ? '+' : '-'} ${Math.abs(b)} = ${c}`;
                    distractors = this.getDistractorsType2(x, a, b, c);
                    
                    const bSign = b >= 0 ? '+' : '-';
                    const bAbs = Math.abs(b);
                    const afterB = c - b;
                    
                    if (b >= 0) {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼š' + a + 'x + ' + b + ' = ' + c + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„å‡å» ' + b + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x + ' + b + ' - ' + b + ' = ' + c + ' - ' + b + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x = ' + afterB + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„é™¤ä»¥ ' + a + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x Ã· ' + a + ' = ' + afterB + ' Ã· ' + a + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    } else {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼š' + a + 'x - ' + bAbs + ' = ' + c + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„åŠ ä¸Š ' + bAbs + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x - ' + bAbs + ' + ' + bAbs + ' = ' + c + ' + ' + bAbs + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x = ' + afterB + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„é™¤ä»¥ ' + a + '</div>' +
                            '<div class="practice-solution-step">' + a + 'x Ã· ' + a + ' = ' + afterB + ' Ã· ' + a + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    }
                } else if (type === 3) {
                    while (true) {a = (Math.floor(Math.random() * 4) + 2) * (Math.random() > 0.5 ? 1 : -1); b = (Math.floor(Math.random() * 6) + 1) * (Math.random() > 0.5 ? 1 : -1); c = a * (x + b); if (a !== 0 && b !== 0 && c !== 0) break;}
                    eq = `${a}(x ${b >= 0 ? '+' : '-'} ${Math.abs(b)}) = ${c}`;
                    distractors = this.getDistractorsType3(x, a, b, c);
                    
                    const bSign = b >= 0 ? '+' : '-';
                    const bAbs = Math.abs(b);
                    const insideBracket = c / a;
                    
                    if (b >= 0) {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼š' + a + '(x + ' + b + ') = ' + c + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„é™¤ä»¥ ' + a + '</div>' +
                            '<div class="practice-solution-step">' + a + '(x + ' + b + ') Ã· ' + a + ' = ' + c + ' Ã· ' + a + '</div>' +
                            '<div class="practice-solution-step">x + ' + b + ' = ' + insideBracket + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„å‡å» ' + b + '</div>' +
                            '<div class="practice-solution-step">x + ' + b + ' - ' + b + ' = ' + insideBracket + ' - ' + b + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    } else {
                        solution = '<div class="practice-solution-step">åŸå¼ï¼š' + a + '(x - ' + bAbs + ') = ' + c + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„é™¤ä»¥ ' + a + '</div>' +
                            '<div class="practice-solution-step">' + a + '(x - ' + bAbs + ') Ã· ' + a + ' = ' + c + ' Ã· ' + a + '</div>' +
                            '<div class="practice-solution-step">x - ' + bAbs + ' = ' + insideBracket + '</div>' +
                            '<div class="practice-solution-step">ç­‰å·å·¦å³å„åŠ ä¸Š ' + bAbs + '</div>' +
                            '<div class="practice-solution-step">x - ' + bAbs + ' + ' + bAbs + ' = ' + insideBracket + ' + ' + bAbs + '</div>' +
                            '<div class="practice-solution-step">x = ' + x + '</div>' +
                            '<div class="practice-solution-answer">ç­”æ¡ˆï¼šx = ' + x + '</div>';
                    }
                }

                let options = this.buildOptions(x, distractors);
                return {equation: eq, answer: x, options, solution};
            }
        }

        class Player {
            constructor(id, canvasId, nextId, scoreId, mathId) {
                this.id = id; this.canvas = document.getElementById(canvasId); this.ctx = this.canvas.getContext('2d');
                this.nextCanvas = document.getElementById(nextId); this.nextCtx = this.nextCanvas.getContext('2d');
                this.scoreElement = document.getElementById(scoreId); this.mathUI = document.getElementById(mathId);
                this.board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
                this.score = 0; this.pos = {x: 0, y: 0}; this.matrix = null; this.nextMatrix = null;
                this.isBombActive = false; this.bombIsNext = false;
                this.keyboardLeft = this.keyboardRight = this.keyboardDown = false;
                this.gamepadLeft = this.gamepadRight = this.gamepadDown = false;
                this.touchLeft = this.touchRight = this.touchDown = false;
                this.waitReleaseDown = false;
                this.moveCounter = 0; this.moveInterval = 100; this.dasDelay = 200; this.moveLocked = false;
                this.keys = {left: false, right: false};
                this.dropCounter = 0; this.dropInterval = 1000;
                this.isSolving = false; this.currentProblem = null; this.selectedIndex = 0;
                this.feedbackShowing = false;
                this.lastGamepadState = {left: false, right: false, up: false, down: false, btn0: false, btn1: false};
                this.wrongAnswers = [];
                this.setNextPiece(); this.resetPiece();
            }

            setNextPiece() {
                const type = (Math.random() * 7 | 0) + 1;
                let matrix = SHAPES[type].map(row => [...row]);
                if (Math.random() < 0.2) {
                    let blocks = []; matrix.forEach((row, y) => row.forEach((v, x) => {if (v) blocks.push({x, y});}));
                    if (blocks.length > 0) {const target = blocks[Math.floor(Math.random() * blocks.length)]; matrix[target.y][target.x] = 10;}
                }
                this.nextMatrix = matrix;
            }

            resetPiece() {
                if (this.bombIsNext) {this.matrix = [[11]]; this.isBombActive = true; this.bombIsNext = false;}
                else {this.matrix = this.nextMatrix; this.isBombActive = false; this.setNextPiece();}
                this.pos.y = 0; this.pos.x = (COLS / 2 | 0) - (this.matrix[0].length / 2 | 0);
                this.waitReleaseDown = true;
                if (this.collide()) endGame(this.id);
                this.drawNext();
            }

            collide(offset = {x: 0, y: 0}) {
                const m = this.matrix; const p = this.pos;
                for (let y = 0; y < m.length; ++y) {
                    for (let x = 0; x < m[y].length; ++x) {
                        if (m[y][x] !== 0) {
                            const newY = y + p.y + offset.y, newX = x + p.x + offset.x;
                            if (newX < 0 || newX >= COLS || newY >= ROWS) return true;
                            if (newY >= 0 && this.board[newY][newX] !== 0) return true;
                        }
                    }
                }
                return false;
            }

            drop() {
                if (this.isSolving || isGameOver || isPaused) return;
                this.pos.y++;
                if (this.collide()) {
                    this.pos.y--;
                    if (this.isBombActive) {this.explode(); this.resetPiece();}
                    else {this.join(); this.sweep(); this.resetPiece();}
                }
                this.dropCounter = 0;
            }

            explode() {
                const centerX = this.pos.x, centerY = this.pos.y;
                for (let y = centerY - 2; y <= centerY + 2; y++) {
                    for (let x = centerX - 2; x <= centerX + 2; x++) {
                        if (y >= 0 && y < ROWS && x >= 0 && x < COLS) this.board[y][x] = 0;
                    }
                }
                flashScreen();
            }

            move(dir) {
                if (isGameOver || isPaused) return;
                if (this.isSolving) {this.selectMathOption(dir, 0); return;}
                this.pos.x += dir; if (this.collide()) {this.pos.x -= dir; return false;} return true;
            }

            rotate() {
                if (this.isSolving || isGameOver || isPaused || this.isBombActive) return;
                const m = this.matrix;
                for (let y = 0; y < m.length; ++y) for (let x = 0; x < y; ++x) [m[x][y], m[y][x]] = [m[y][x], m[x][y]];
                m.forEach(row => row.reverse());
                if (this.collide()) {
                    m.forEach(row => row.reverse());
                    for (let y = 0; y < m.length; ++y) for (let x = 0; x < y; ++x) [m[x][y], m[y][x]] = [m[y][x], m[x][y]];
                }
            }

            join() {this.matrix.forEach((row, y) => {row.forEach((value, x) => {if (value !== 0) {const newY = y + this.pos.y; if (newY >= 0) this.board[newY][x + this.pos.x] = value;} });});}

            sweep() {
                let rowCount = 0, hasSpecial = false;
                outer: for (let y = ROWS - 1; y >= 0; --y) {
                    let full = true; for (let x = 0; x < COLS; ++x) if (this.board[y][x] === 0) {full = false; break;}
                    if (!full) continue outer;
                    for (let x = 0; x < COLS; ++x) if (this.board[y][x] === 10) hasSpecial = true;
                    this.board.splice(y, 1); this.board.unshift(Array(COLS).fill(0));
                    ++y; rowCount++;
                }
                if (rowCount > 0) {
                    const scores = [0, 1, 5, 25, 100]; const add = scores[rowCount] || 0;
                    this.score += add; this.scoreElement.innerText = this.score; this.showPopScore(add);
                    const opponent = (this.id === 'A') ? playerB : playerA;
                    opponent.receiveAttack(rowCount); opponent.triggerMath(rowCount);
                    flashScreen(); if (hasSpecial) this.bombIsNext = true;
                }
            }

            receiveAttack(lines) {
                for (let i = 0; i < lines; i++) {
                    const topRowOccupied = this.board[0].some(val => val !== 0);
                    const row = Array(COLS).fill(8); row[Math.floor(Math.random() * COLS)] = 0;
                    this.board.shift();
                    this.board.push(row);
                    if (topRowOccupied || this.collide()) {
                        endGame(this.id);
                        return;
                    }
                }
            }

            triggerMath(lines) {
                if (lines < 1) return;
                this.isSolving = true; this.currentProblem = MathEngine.generateByLines(lines); this.selectedIndex = 0;
                this.mathUI.style.display = 'block'; this.renderMath();
            }

            renderMath() {
                const eqDiv = this.mathUI.querySelector('.math-equation'), optDiv = this.mathUI.querySelector('.math-options');
                eqDiv.innerText = this.currentProblem.equation; optDiv.innerHTML = '';
                this.currentProblem.options.forEach((opt, i) => {
                    const btn = document.createElement('div'); btn.className = `option-btn ${i === this.selectedIndex ? 'selected' : ''}`; btn.innerText = opt;
                    btn.onclick = () => {this.selectedIndex = i; this.confirmAnswer();};
                    optDiv.appendChild(btn);
                });
            }

            selectMathOption(dirX, dirY) {
                if (!this.isSolving) return;
                let newIndex = this.selectedIndex;
                if (dirX !== 0) {const row = Math.floor(newIndex / 2); newIndex = row * 2 + (newIndex % 2 + dirX + 2) % 2;}
                if (dirY !== 0) newIndex = (newIndex + dirY * 2 + 4) % 4;
                this.selectedIndex = newIndex; this.renderMath();
            }

            confirmAnswer() {
                if (!this.isSolving || this.feedbackShowing) return;
                const selectedAnswer = this.currentProblem.options[this.selectedIndex];
                const isCorrect = selectedAnswer === this.currentProblem.answer;
                
                this.feedbackShowing = true;
                const feedback = document.createElement('div');
                feedback.className = `answer-feedback ${isCorrect ? 'correct' : 'wrong'}`;
                feedback.innerText = isCorrect ? 'âœ“' : 'âœ—';
                this.mathUI.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.remove();
                    this.feedbackShowing = false;
                    if (isCorrect) {
                        this.isSolving = false;
                        this.mathUI.style.display = 'none';
                    } else {
                        this.wrongAnswers.push({
                            equation: this.currentProblem.equation,
                            options: [...this.currentProblem.options],
                            correctAnswer: this.currentProblem.answer,
                            wrongChoice: selectedAnswer,
                            player: this.id
                        });
                        this.receiveAttack(1);
                        this.currentProblem = MathEngine.generateByLines(1);
                        this.renderMath();
                    }
                }, 600);
            }

            showPopScore(val) {
                const pop = document.createElement('div'); pop.className = 'score-pop'; pop.innerText = `+${val}`; pop.style.left = '50%'; pop.style.top = '45%';
                this.canvas.parentElement.appendChild(pop); setTimeout(() => pop.remove(), 1200);
            }

            draw() {
                this.ctx.fillStyle = '#000'; this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.drawMatrix(this.board, {x: 0, y: 0}); this.drawMatrix(this.matrix, this.pos);
                if (this.isSolving) {this.ctx.fillStyle = 'rgba(255, 0, 0, 0.2)'; this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);}
            }

            drawMatrix(matrix, offset) {
                matrix.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value !== 0) {
                            const px = (x + offset.x) * BLOCK_SIZE, py = (y + offset.y) * BLOCK_SIZE;
                            if (value === 11) {this.ctx.fillStyle = COLORS[11]; this.ctx.beginPath(); this.ctx.arc(px + BLOCK_SIZE / 2, py + BLOCK_SIZE / 2, BLOCK_SIZE / 2 - 1, 0, Math.PI * 2); this.ctx.fill(); this.ctx.strokeStyle = '#fff'; this.ctx.stroke();}
                            else {this.ctx.fillStyle = COLORS[value]; this.ctx.fillRect(px, py, BLOCK_SIZE, BLOCK_SIZE); this.ctx.strokeStyle = '#111'; this.ctx.strokeRect(px, py, BLOCK_SIZE, BLOCK_SIZE); if (value === 10) {this.ctx.fillStyle = '#000'; this.ctx.font = 'bold 12px Segoe UI'; this.ctx.textAlign = 'center'; this.ctx.fillText('B', px + BLOCK_SIZE / 2, py + BLOCK_SIZE - 5);} }
                        }
                    });
                });
            }

            drawNext() {
                this.nextCtx.fillStyle = '#0f3460'; this.nextCtx.fillRect(0, 0, 50, 50);
                const m = this.bombIsNext ? [[11]] : this.nextMatrix, s = 10;
                m.forEach((row, y) => {row.forEach((v, x) => {if (v) {this.nextCtx.fillStyle = COLORS[v]; if (v === 11) {this.nextCtx.beginPath(); this.nextCtx.arc(10 + x * s + s / 2, 10 + y * s + s / 2, s / 2, 0, Math.PI * 2); this.nextCtx.fill();} else {this.nextCtx.fillRect(10 + x * s, 10 + y * s, s, s);} } });});
            }

            updateMovement(dt) {
                if (this.isSolving || isGameOver || isPaused) return;
                const left = this.keyboardLeft || this.gamepadLeft || this.touchLeft, right = this.keyboardRight || this.gamepadRight || this.touchRight;
                let moveDir = 0; if (left) moveDir = -1; else if (right) moveDir = 1;
                if (moveDir !== 0) {
                    if (!this.moveLocked) {this.move(moveDir); this.moveLocked = true; this.moveCounter = 0;}
                    else {this.moveCounter += dt; if (this.moveCounter > this.dasDelay) {if (this.moveCounter - this.dasDelay > this.moveInterval) {this.move(moveDir); this.moveCounter = this.dasDelay;} } }
                } else this.moveLocked = false;
            }
        }

        const playerA = new Player('A', 'canvas-a', 'next-a', 'score-a', 'math-a'), playerB = new Player('B', 'canvas-b', 'next-b', 'score-b', 'math-b');

        function touchInput(e, pID, action, isPressed) {
            if (e) e.preventDefault();
            const p = (pID === 'A') ? playerA : playerB;
            const btnEl = e?.target;
            if (btnEl && btnEl.classList.contains('t-btn')) {
                if (isPressed) btnEl.classList.add('active');
                else btnEl.classList.remove('active');
            }
            if (action === 'left') {if (p.isSolving && isPressed) p.selectMathOption(-1, 0); else p.touchLeft = isPressed;}
            if (action === 'right') {if (p.isSolving && isPressed) p.selectMathOption(1, 0); else p.touchRight = isPressed;}
            if (action === 'down') p.touchDown = isPressed;
            if (action === 'up' && isPressed) {
                if (p.isSolving) p.selectMathOption(0, -1);
                else p.rotate();
            }
            if (action === 'down' && isPressed && p.isSolving) p.selectMathOption(0, 1);
        }

        function highlightButton(pID, action, isActive) {
            const touchId = pID === 'A' ? 'touch-a' : 'touch-b';
            const touchContainer = document.getElementById(touchId);
            const btn = touchContainer.querySelector(`.t-btn.${action}`);
            if (btn) {
                if (isActive) btn.classList.add('active');
                else btn.classList.remove('active');
            }
        }

        window.addEventListener('keydown', e => {
            if (isPaused || isGameOver) return;
            const code = e.code;
            if (code === 'KeyA') {if (playerA.isSolving) playerA.selectMathOption(-1, 0); else {playerA.keyboardLeft = true; highlightButton('A', 'left', true);}}
            if (code === 'KeyD') {if (playerA.isSolving) playerA.selectMathOption(1, 0); else {playerA.keyboardRight = true; highlightButton('A', 'right', true);}}
            if (code === 'KeyS') {if (playerA.isSolving) playerA.selectMathOption(0, 1); else {playerA.keyboardDown = true; highlightButton('A', 'down', true);}}
            if (code === 'KeyW') {if (playerA.isSolving) playerA.selectMathOption(0, -1); else {playerA.rotate(); highlightButton('A', 'up', true); setTimeout(() => highlightButton('A', 'up', false), 100);}}
            if (code === 'KeyQ' && playerA.isSolving) playerA.confirmAnswer();

            if (code === 'ArrowLeft') {if (playerB.isSolving) playerB.selectMathOption(-1, 0); else {playerB.keyboardLeft = true; highlightButton('B', 'left', true);}}
            if (code === 'ArrowRight') {if (playerB.isSolving) playerB.selectMathOption(1, 0); else {playerB.keyboardRight = true; highlightButton('B', 'right', true);}}
            if (code === 'ArrowDown') {if (playerB.isSolving) playerB.selectMathOption(0, 1); else {playerB.keyboardDown = true; highlightButton('B', 'down', true);}}
            if (code === 'ArrowUp') {if (playerB.isSolving) playerB.selectMathOption(0, -1); else {playerB.rotate(); highlightButton('B', 'up', true); setTimeout(() => highlightButton('B', 'up', false), 100);}}
            if (code === 'Enter' && playerB.isSolving) playerB.confirmAnswer();
        });

        window.addEventListener('keyup', e => {
            const code = e.code;
            if (code === 'KeyA') {playerA.keyboardLeft = false; highlightButton('A', 'left', false);}
            if (code === 'KeyD') {playerA.keyboardRight = false; highlightButton('A', 'right', false);}
            if (code === 'KeyS') {playerA.keyboardDown = false; highlightButton('A', 'down', false);}
            if (code === 'ArrowLeft') {playerB.keyboardLeft = false; highlightButton('B', 'left', false);}
            if (code === 'ArrowRight') {playerB.keyboardRight = false; highlightButton('B', 'right', false);}
            if (code === 'ArrowDown') {playerB.keyboardDown = false; highlightButton('B', 'down', false);}
        });

        function pollGamepads() {
            const gamepads = navigator.getGamepads(); if (!gamepads) return;
            [playerA, playerB].forEach((p, i) => {
                const gp = gamepads[i]; if (!gp) return;
                const down = gp.axes[1] > 0.5 || gp.buttons[13]?.pressed, up = gp.axes[1] < -0.5 || gp.buttons[12]?.pressed, left = gp.axes[0] < -0.5 || gp.buttons[14]?.pressed, right = gp.axes[0] > 0.5 || gp.buttons[15]?.pressed, b0 = gp.buttons[0].pressed, b1 = gp.buttons[1].pressed;
                if (!down) p.waitReleaseDown = false;
                if (p.isSolving) {
                    if (left && !p.lastGamepadState.left) p.selectMathOption(-1, 0); if (right && !p.lastGamepadState.right) p.selectMathOption(1, 0);
                    if (down && !p.lastGamepadState.down) p.selectMathOption(0, 1); if (up && !p.lastGamepadState.up) p.selectMathOption(0, -1);
                    if (b0 && !p.lastGamepadState.btn0) p.confirmAnswer();
                } else {
                    p.gamepadLeft = left; p.gamepadRight = right; p.gamepadDown = down && !p.waitReleaseDown;
                    if (b1 && !p.lastGamepadState.btn1) p.rotate();
                }
                p.lastGamepadState = {left, right, up, down, btn0: b0, btn1: b1};
            });
        }

        let lastTime = 0;
        function update(time = 0) {
            const dt = time - lastTime; lastTime = time; pollGamepads();
            [playerA, playerB].forEach(p => {
                p.updateMovement(dt); if (!p.isSolving && !isGameOver && !isPaused) {
                    p.dropCounter += dt; const isSD = p.keyboardDown || p.gamepadDown || p.touchDown;
                    if (p.dropCounter > (isSD ? 50 : p.dropInterval)) {p.drop(); p.dropCounter = 0;}
                }
                p.draw();
            });
            requestAnimationFrame(update);
        }

        function endGame(loserId) {
            if (isGameOver) return;
            isGameOver = true;
            const winnerId = loserId === 'A' ? 'B' : 'A';
            
            const loserOverlay = document.getElementById(`result-${loserId.toLowerCase()}`);
            const loserText = document.getElementById(`result-text-${loserId.toLowerCase()}`);
            loserOverlay.classList.add('loser');
            loserText.classList.add('loser');
            loserText.innerText = 'Game Over!';
            loserOverlay.style.display = 'block';
            
            const winnerOverlay = document.getElementById(`result-${winnerId.toLowerCase()}`);
            const winnerText = document.getElementById(`result-text-${winnerId.toLowerCase()}`);
            winnerOverlay.classList.add('winner');
            winnerText.classList.add('winner');
            winnerText.innerText = 'æ­å–œè·èƒœï¼';
            winnerOverlay.style.display = 'block';
            
            document.getElementById('global-over-buttons').style.display = 'flex';
            
            // Play victory music for 5 seconds
            if (audioEnabled) {
                currentBgmIndex = Math.floor(Math.random() * BGM_FILES.length);
                playNextBgm();
                setTimeout(() => { bgmPlayer.pause(); }, 5000);
            }
            
            // Add celebration animation to winner's board
            const winnerBoard = winnerId === 'A' ? playerA.canvas.parentElement : playerB.canvas.parentElement;
            createCelebration(winnerBoard);
        }

        function createCelebration(boardElement) {
            const container = document.createElement('div');
            container.className = 'celebration-container';
            boardElement.appendChild(container);
            
            const colors = ['#ff0', '#0f0', '#0ff', '#f0f', '#f90', '#9f0', '#ff69b4', '#00ffcc'];
            const shapes = ['â– ', 'â—', 'â˜…', 'â–²', 'â™¦'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.fontSize = (8 + Math.random() * 12) + 'px';
                    confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    confetti.innerText = shapes[Math.floor(Math.random() * shapes.length)];
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 60);
            }
        }

        let reviewState = {
            A: { questions: [], selectedAnswers: {}, attempted: false, revealed: false, passed: false },
            B: { questions: [], selectedAnswers: {}, attempted: false, revealed: false, passed: false }
        };

        function openReview() {
            bgmPlayer.pause();
            
            reviewState = {
                A: { questions: [...playerA.wrongAnswers], selectedAnswers: {}, attempted: false, revealed: false, passed: false },
                B: { questions: [...playerB.wrongAnswers], selectedAnswers: {}, attempted: false, revealed: false, passed: false }
            };
            
            document.getElementById('result-a').style.display = 'none';
            document.getElementById('result-b').style.display = 'none';
            document.getElementById('global-over-buttons').style.display = 'none';
            document.getElementById('review-overlay').style.display = 'flex';
            document.getElementById('review-restart').style.display = 'none';
            renderReviewQuestions();
        }

        function renderReviewQuestions() {
            ['A', 'B'].forEach(pid => {
                const state = reviewState[pid];
                const container = document.getElementById(`review-questions-${pid.toLowerCase()}`);
                const statusEl = document.getElementById(`review-status-${pid.toLowerCase()}`);
                const submitBtn = document.getElementById(`submit-${pid.toLowerCase()}`);
                
                if (state.questions.length === 0) {
                    container.innerHTML = '<div class="no-wrong-answers" style="text-align:center;color:#00ffcc;padding:20px;">æ²¡æœ‰ç­”é”™çš„é¢˜ç›®</div>';
                    statusEl.innerHTML = '';
                    submitBtn.style.display = 'none';
                    state.passed = true;
                } else {
                    container.innerHTML = state.questions.map((q, qIdx) => {
                        return `
                            <div class="review-question" data-player="${pid}" data-qidx="${qIdx}">
                                <div class="review-equation">${q.equation}</div>
                                <div class="review-options">
                                    ${q.options.map((opt, optIdx) => {
                                        let className = 'review-option';
                                        const isSelected = state.selectedAnswers[qIdx] === optIdx;
                                        const isCorrect = opt === q.correctAnswer;
                                        
                                        if (state.revealed) {
                                            if (isCorrect) {
                                                className += ' correct-revealed';
                                            } else if (isSelected && !isCorrect) {
                                                className += ' wrong-revealed';
                                            } else {
                                                className += ' normal';
                                            }
                                        } else {
                                            if (isSelected) {
                                                className += ' selected';
                                            } else {
                                                className += ' normal';
                                            }
                                        }
                                        
                                        const clickable = !state.revealed && !state.attempted;
                                        return '<div class="' + className + '"' + (clickable ? ' onclick="selectReviewOption(\'' + pid + '\', ' + qIdx + ', ' + optIdx + ')"' : '') + '>' + opt + '</div>';
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    if (state.passed) {
                        statusEl.className = 'review-status pass';
                        statusEl.innerHTML = 'é€šè¿‡ï¼ç­”æ¡ˆå·²å…¬å¸ƒ';
                        submitBtn.style.display = 'none';
                    } else if (state.attempted && !state.passed) {
                        statusEl.className = 'review-status fail';
                        statusEl.innerHTML = 'é”™è¯¯è¶…è¿‡50%ï¼Œè¯·é‡æ–°ä½œç­”';
                        submitBtn.innerText = 'é‡æ–°ä½œç­”';
                        submitBtn.onclick = () => retryPlayer(pid);
                        submitBtn.style.display = 'inline-block';
                    } else {
                        statusEl.className = 'review-status';
                        statusEl.innerHTML = '';
                        submitBtn.innerText = 'æäº¤ç­”æ¡ˆ';
                        submitBtn.onclick = () => submitReviewPlayer(pid);
                        submitBtn.style.display = 'inline-block';
                    }
                }
            });
            
            const bothPassed = reviewState.A.passed && reviewState.B.passed;
            const bothFailed = reviewState.A.attempted && !reviewState.A.passed && 
                              reviewState.B.attempted && !reviewState.B.passed;
            const restartBtn = document.getElementById('review-restart');
            restartBtn.style.display = (bothPassed || bothFailed) ? 'inline-block' : 'none';
        }

        function selectReviewOption(pid, qIdx, optIdx) {
            const state = reviewState[pid];
            if (state.revealed || state.attempted) return;
            state.selectedAnswers[qIdx] = optIdx;
            renderReviewQuestions();
        }

        function submitReviewPlayer(pid) {
            const state = reviewState[pid];
            if (state.questions.length === 0) return;
            
            let correct = 0;
            state.questions.forEach((q, qIdx) => {
                const selectedIdx = state.selectedAnswers[qIdx];
                if (selectedIdx !== undefined && q.options[selectedIdx] === q.correctAnswer) {
                    correct++;
                }
            });
            
            const passThreshold = Math.ceil(state.questions.length / 2);
            state.attempted = true;
            state.passed = correct >= passThreshold;
            state.revealed = state.passed;
            renderReviewQuestions();
        }

        function retryPlayer(pid) {
            const state = reviewState[pid];
            state.selectedAnswers = {};
            state.attempted = false;
            state.revealed = false;
            state.passed = false;
            renderReviewQuestions();
        }

        let practiceState = {
            questions: [],
            selectedAnswers: {},
            submitted: false
        };

        function openPracticeMode() {
            document.getElementById('help-overlay').style.display = 'none';
            practiceState = {
                questions: [
                    MathEngine.generatePractice(1),
                    MathEngine.generatePractice(2),
                    MathEngine.generatePractice(3)
                ],
                selectedAnswers: {},
                submitted: false
            };
            document.getElementById('practice-submit').style.display = 'inline-block';
            document.getElementById('practice-retry').style.display = 'none';
            document.getElementById('practice-home').style.display = 'none';
            document.getElementById('practice-overlay').style.display = 'flex';
            renderPracticeQuestions();
        }

        function closePracticeMode() {
            document.getElementById('practice-overlay').style.display = 'none';
            document.getElementById('help-overlay').style.display = 'flex';
        }

        function renderPracticeQuestions() {
            const container = document.getElementById('practice-questions');
            const typeNames = ['ç±»å‹ä¸€ï¼šx Â± a = b', 'ç±»å‹äºŒï¼šax Â± b = c', 'ç±»å‹ä¸‰ï¼ša(x Â± b) = c'];
            
            container.innerHTML = practiceState.questions.map((q, qIdx) => {
                let resultMark = '';
                if (practiceState.submitted) {
                    const selectedIdx = practiceState.selectedAnswers[qIdx];
                    const isCorrect = selectedIdx !== undefined && q.options[selectedIdx] === q.answer;
                    resultMark = isCorrect 
                        ? '<span class="practice-result-mark correct">âœ“</span>'
                        : '<span class="practice-result-mark wrong">âœ—</span>';
                }
                
                return '<div class="practice-question">' +
                    '<div class="practice-question-header">' +
                        '<span>' + typeNames[qIdx] + '</span>' +
                        resultMark +
                    '</div>' +
                    '<div class="practice-equation">' + q.equation + '</div>' +
                    '<div class="practice-options">' +
                        q.options.map((opt, optIdx) => {
                            let className = 'practice-option';
                            const isSelected = practiceState.selectedAnswers[qIdx] === optIdx;
                            const isCorrect = opt === q.answer;
                            
                            if (practiceState.submitted) {
                                if (isCorrect) {
                                    className += ' correct-revealed';
                                } else if (isSelected && !isCorrect) {
                                    className += ' wrong-revealed';
                                }
                            } else {
                                if (isSelected) {
                                    className += ' selected';
                                }
                            }
                            
                            const clickable = !practiceState.submitted;
                            return '<div class="' + className + '"' + 
                                (clickable ? ' onclick="selectPracticeOption(' + qIdx + ', ' + optIdx + ')"' : '') + 
                                '>' + opt + '</div>';
                        }).join('') +
                    '</div>' +
                    '<div class="practice-solution" id="solution-' + qIdx + '">' +
                        '<div class="practice-solution-title">è§£é¢˜æ€è·¯</div>' +
                        '<div id="solution-steps-' + qIdx + '"></div>' +
                    '</div>' +
                '</div>';
            }).join('');
        }

        function selectPracticeOption(qIdx, optIdx) {
            if (practiceState.submitted) return;
            practiceState.selectedAnswers[qIdx] = optIdx;
            renderPracticeQuestions();
        }

        function submitPractice() {
            practiceState.submitted = true;
            renderPracticeQuestions();
            
            practiceState.questions.forEach((q, qIdx) => {
                const selectedIdx = practiceState.selectedAnswers[qIdx];
                const isCorrect = selectedIdx !== undefined && q.options[selectedIdx] === q.answer;
                
                if (!isCorrect) {
                    const solutionDiv = document.getElementById('solution-' + qIdx);
                    const stepsDiv = document.getElementById('solution-steps-' + qIdx);
                    solutionDiv.style.display = 'block';
                    stepsDiv.innerHTML = q.solution;
                }
            });
            
            document.getElementById('practice-submit').style.display = 'none';
            document.getElementById('practice-retry').style.display = 'inline-block';
            document.getElementById('practice-home').style.display = 'inline-block';
        }

        function startGameSession() {
            isPaused = false; isGameOver = false; document.getElementById('help-overlay').style.display = 'none';
            document.getElementById('main-start-btn').style.display = 'none'; document.getElementById('practice-btn').style.display = 'none';
            document.getElementById('restart-btn').style.display = 'block';
            document.getElementById('touch-a').style.display = 'grid'; document.getElementById('touch-b').style.display = 'grid';
            if (audioEnabled) {currentBgmIndex = Math.floor(Math.random() * BGM_FILES.length); playNextBgm();}
        }

        update(); document.getElementById('help-overlay').style.display = 'flex';
    </script>
</body>

</html>